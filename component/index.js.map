{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/* global XMLHttpRequest, ActiveXObject, window, global */\n\nfunction XHR() {\n  if (window.XMLHttpRequest) return new XMLHttpRequest();\n  try { return new ActiveXObject('msxml2.xmlhttp.6.0'); } catch (e) {}\n  try { return new ActiveXObject('msxml2.xmlhttp.3.0'); } catch (e) {}\n  try { return new ActiveXObject('msxml2.xmlhttp'); } catch (e) {}\n}\n\nfunction contains(array, value) {\n  var i = array.length;\n  while (i--) if (array[i] === value) return true;\n  return false;\n}\n\nvar okStatus = [200, 304, 0];\nfunction requestOk(req) { return contains(okStatus, req.status); }\n\nclass XHRError extends Error {\n  constructor(message, status, request) {\n    this.message = message;\n    this.status = status;\n    this.request = request;\n    this.responseHeaders = request.responseHeaders;\n  }\n}\n\nfunction callbacks(name, req, targets) {\n  for (var i = 0; i < targets.length; i++) {\n    if (typeof targets[i][name] === 'function') targets[i][name](req);\n  }\n}\n\nfunction merge() {\n  var res = {}, arg, k;\n  for (var i = 0; i < arguments.length; i++) {\n    arg = arguments[i];\n    if (typeof arg === 'object') {\n      for (k in arg) {\n        res[k] = arg[k];\n      }\n    }\n  }\n  return res;\n}\n\nvar betweenQueryAndHash = /\\?[^#]*#/;\nvar afterQuery = /\\?.*/;\n\nexport default function build(opts) {\n  var Promise = opts.promise || opts.Promise || (window || {}).Promise || (global || {}).Promise;\n\n  if (!Promise) throw new Error('I really need a Promise');\n\n  function xhr(options = {}) {\n    var req = XHR();\n\n    options.headers = options.headers || {};\n\n    if (options.binary && !req.sendAsBinary) return Promise.reject(new Error('This browser does not support binary XHRs.'));\n\n    callbacks('onbegin', req, [opts, options]);\n\n    if (typeof options === 'string') options = { url: options };\n\n    if (options.query && typeof options.query === 'object') {\n      let qs = '';\n      for (let k in options.query) {\n        let v = options.query[k];\n        if (typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean') {\n          qs += (qs ? '&' : '') + `${encodeURIComponent(k)}=${encodeURIComponent(v)}`;\n        }\n      }\n\n      let hash = options.url.indexOf('#') !== -1,\n          query = options.url.indexOf('?') !== -1;\n\n      if (hash && query) {\n        options.url = options.url.replace(betweenQueryAndHash, `?${qs}#`);\n      } else if (hash) {\n        options.url = options.url.replace('#', `?${qs}#`);\n      } else if (query) {\n        options.url = options.url.replace(afterQuery, `?${qs}`);\n      } else {\n        options.url += `?${qs}`;\n      }\n    }\n\n    req.open(options.method || 'GET', options.url, true);\n    if (options.credentials) req.withCredentials = true;\n\n    for (let k in options.headers) req.setRequestHeader(k, options.headers[k]);\n    if (options.method === 'POST' && (!('Content-Type' in options.headers) && !('type' in options))) {\n      req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    } else if ('type' in options) {\n      req.setRequestHeader('Content-Type', options.type);\n    }\n\n    if ('responseType' in options) req.responseType = options.responseType;\n\n    var res = new Promise((ok, fail) => {\n      req.onreadystatechange = () => {\n        if (req.readyState !== 4) return;\n\n        callbacks('onend', req, [opts, options]);\n\n        if (requestOk(req)) {\n          ok(req);\n        } else {\n          let res = req.responseHeaders = {};\n          if (typeof req.getAllResponseHeaders === 'function') {\n            let headers = req.getAllResponseHeaders().split('\\n');\n            for (let i = 0; i < headers.length; i++) {\n              let n = headers[i].substr(0, headers[i].indexOf(':'));\n              if (!n) continue;\n              let v = headers[i].substr(n.length + 1);\n              res[n] = v;\n              res[n.toLowerCase()] = v;\n            }\n          }\n          fail(new XHRError('Server responded with a status of ' + req.status, req.status, req));\n        }\n      };\n    });\n\n    req[options.binary ? 'sendAsBinary' : 'send'](options.data || void 0);\n\n    return res;\n  }\n\n  (function() {\n    xhr.get = function get(url, opts) { return xhr(merge({ url }, opts)); };\n    xhr.post = function post(url, data, opts) { return xhr(merge({ method: 'POST', url, data }, opts)); };\n    xhr.put = function put(url, data, opts) { return xhr(merge({ method: 'PUT', url, data }, opts)); };\n    xhr['delete'] = xhr.del = function del(url, data, opts) { return xhr(merge({ method: 'DELETE', url, data }, opts)); };\n  })();\n\n  (function() {\n    var json = xhr.json = function json(options = {}) {\n      if (typeof options === 'string') options = { url: options };\n      var headers = options.headers = options.headers || {};\n      if (!('Accept' in headers)) headers.Accept = 'application/json,*/*';\n      if (!('Content-Type' in headers) && !('type' in options)) headers['Content-Type'] = 'application/json';\n      if (typeof options.data !== 'string') options.data = JSON.stringify(options.data || '');\n      return xhr(options).then(res => {\n        if ((res.getResponseHeader('Content-Type') || '').toLowerCase().indexOf('json') !== -1) {\n          return JSON.parse(res.responseText);\n        } else return res;\n      });\n    };\n    json.get = function get(url, opts) { return json(merge({ url }, opts)); };\n    json.post = function post(url, data, opts) { return json(merge({ method: 'POST', url, data }, opts)); };\n    json.put = function put(url, data, opts) { return json(merge({ method: 'PUT', url, data }, opts)); };\n    json['delete'] = json.del = function del(url, data, opts) { return json(merge({ method: 'DELETE', url, data }, opts)); };\n  })();\n\n  return xhr;\n}\n"],"names":[],"mappings":"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"}